<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="SpringBoot Unit Test"><meta name="keywords" content="SpringBoot,UnitTest"><meta name="author" content="JIE,undefined"><meta name="copyright" content="JIE"><title>SpringBoot Unit Test【JIE's Blos】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/"><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: ,
  valine: ,
}</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="JIE's Blos" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#For-What"><span class="toc-number">1.</span> <span class="toc-text">For What</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Layer-Test-Mockito"><span class="toc-number">2.</span> <span class="toc-text">Layer Test : Mockito</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Conclusion"><span class="toc-number">2.1.</span> <span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Example"><span class="toc-number">2.2.</span> <span class="toc-text">Example:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#integration-test-embedded-db-in-memory-db-sql-initialization"><span class="toc-number">3.</span> <span class="toc-text">integration test : embedded db(in-memory db) + sql initialization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Conclusion-1"><span class="toc-number">3.1.</span> <span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Example-1"><span class="toc-number">3.2.</span> <span class="toc-text">Example:</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/images/avatar.png"></div><div class="author-info-name">JIE</div><div class="author-info-description">JIE's Blos</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/stableship" target="_blank">GitHub<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="mailto:jiezdok@gmail.com" target="_blank">E-Mail<i class="icon-dot bg-color10"></i></a><a class="links-button button-hover" href="tencent://message/?uin=296888680&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color3"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">32</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">39</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">12</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a></nav><div class="right-info"><a class="title-name" href="/">JIE's Blos</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">SpringBoot Unit Test</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2020-01-15 | 更新于 2021-06-11</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/SpringBoot/">SpringBoot</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/UnitTest/">UnitTest</a></div></div></div><div class="main-content"><h2 id="For-What"><a href="#For-What" class="headerlink" title="For What"></a>For What</h2><p>When we developing a project and serving for the user with a lot of function. And some of this function is called in multiple place. when a new requirement is come which need to modify the code of the old function. How can you ensure the ensure old function won’t be broken by the change you make. human test? too native. Human always make mistake. So we need the machine to check for us.</p>
<h2 id="Layer-Test-Mockito"><a href="#Layer-Test-Mockito" class="headerlink" title="Layer Test : Mockito"></a>Layer Test : Mockito</h2><p>we use mockito to mock all the  dependencies injected (the database, the third party api) to the layer, in the <strong>Controller</strong> layer , we mock the  <strong>Service</strong>  function, in the  <strong>Service</strong>  layer, we mock the  <strong>Dao</strong>  function;</p>
<span id="more"></span>
<hr>
<p>Controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">`<span class="meta">@Test</span>`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">public</span>` `<span class="keyword">void</span>` `testAddEmployee()`</span><br><span class="line"></span><br><span class="line">`&#123;`</span><br><span class="line"></span><br><span class="line">`MockHttpServletRequest request =` `<span class="keyword">new</span>` `MockHttpServletRequest();`</span><br><span class="line"></span><br><span class="line">`RequestContextHolder.setRequestAttributes(``<span class="keyword">new</span>` `ServletRequestAttributes(request));`</span><br><span class="line"></span><br><span class="line">`when(employeeDAO.addEmployee(any(Employee.``<span class="class"><span class="keyword">class</span>``))).<span class="title">thenReturn</span>(``<span class="title">true</span>``)</span>;`</span><br><span class="line"></span><br><span class="line">`Employee employee =` `<span class="keyword">new</span>` `Employee(``<span class="number">1</span>``,` `<span class="string">&quot;Lokesh&quot;</span>``,` `<span class="string">&quot;Gupta&quot;</span>``,` `<span class="string">&quot;howtodoinjava@gmail.com&quot;</span>``);`</span><br><span class="line"></span><br><span class="line">`ResponseEntity&lt;Object&gt; responseEntity = employeeController.addEmployee(employee);`</span><br><span class="line"></span><br><span class="line">`assertThat(responseEntity.getStatusCodeValue()).isEqualTo(``<span class="number">201</span>``);`</span><br><span class="line"></span><br><span class="line">`assertThat(responseEntity.getHeaders().getLocation().getPath()).isEqualTo(``<span class="string">&quot;/1&quot;</span>``);`</span><br><span class="line"></span><br><span class="line">`&#125;`</span><br></pre></td></tr></table></figure>
<hr>
<p>Service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">`<span class="meta">@Test</span>`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">public</span>` `<span class="keyword">void</span>` `getEmployeeByIdTest()`</span><br><span class="line"></span><br><span class="line">`&#123;`</span><br><span class="line"></span><br><span class="line">`when(dao.getEmployeeById(``<span class="number">1</span>``)).thenReturn(``<span class="keyword">new</span>` `EmployeeVO(``<span class="number">1</span>``,``<span class="string">&quot;Lokesh&quot;</span>``,``<span class="string">&quot;Gupta&quot;</span>``,``<span class="string">&quot;user@email.com&quot;</span>``));`</span><br><span class="line"></span><br><span class="line">`EmployeeVO emp = manager.getEmployeeById(``<span class="number">1</span>``);`</span><br><span class="line"></span><br><span class="line">`assertEquals(``<span class="string">&quot;Lokesh&quot;</span>``, emp.getFirstName());`</span><br><span class="line"></span><br><span class="line">`assertEquals(``<span class="string">&quot;Gupta&quot;</span>``, emp.getLastName());`</span><br><span class="line"></span><br><span class="line">`assertEquals(``<span class="string">&quot;user@email.com&quot;</span>``, emp.getEmail());`</span><br><span class="line"></span><br><span class="line">`&#125;`</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><strong>Good: only test the necessary part.</strong></p>
<p><strong>Bad: it take a lot of effort for all the layer for same functionality.</strong></p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example:"></a>Example:</h3><p><a target="_blank" rel="noopener" href="https://howtodoinjava.com/spring-boot2/testing/rest-controller-unit-test-example/">https://howtodoinjava.com/spring-boot2/testing/rest-controller-unit-test-example/</a></p>
<p><a target="_blank" rel="noopener" href="https://howtodoinjava.com/spring-boot2/testing/spring-boot-mockito-junit-example/">https://howtodoinjava.com/spring-boot2/testing/spring-boot-mockito-junit-example/</a></p>
<h2 id="integration-test-embedded-db-in-memory-db-sql-initialization"><a href="#integration-test-embedded-db-in-memory-db-sql-initialization" class="headerlink" title="integration test : embedded db(in-memory db) + sql initialization"></a>integration test : embedded db(in-memory db) + sql initialization</h2><p>Because the Layer Test is cause a lot of effort， so it is easy to give up. and then the Integration test came out</p>
<p><strong>Integration test can test different modules are bounded correctly and if they work as expected in only one test case, no need to write for different layer , save a lot of effort.</strong></p>
<p><strong><em>**</em></strong>Integration test can more similar as the prod by using the embedded db(H2).<strong><em>**</em></strong></p>
<p><strong><strong>Integration test can test for certain behaviors by using the <code>@sql</code> to initial to test data to db.</strong></strong></p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">`<span class="meta">@Sql</span>``(&#123;` `<span class="string">&quot;schema.sql&quot;</span>``,` `<span class="string">&quot;data.sql&quot;</span>` `&#125;)`</span><br><span class="line"></span><br><span class="line">`<span class="meta">@Test</span>`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">public</span>` `<span class="keyword">void</span>` `testAllEmployees()`</span><br><span class="line"></span><br><span class="line">`&#123;`</span><br><span class="line"></span><br><span class="line">`assertTrue(`</span><br><span class="line"></span><br><span class="line">`<span class="keyword">this</span>``.restTemplate`</span><br><span class="line"></span><br><span class="line">`.getForObject(``<span class="string">&quot;[http://localhost:](http://localhost/)&quot;</span>` `+ port +` `<span class="string">&quot;/employees&quot;</span>``, Employees.``<span class="class"><span class="keyword">class</span>``)`</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">`.<span class="title">getEmployeeList</span>().<span class="title">size</span>() </span>==` `<span class="number">3</span>``);`</span><br><span class="line"></span><br><span class="line">`&#125;`</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>integration test is a better choice</p>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example:"></a>Example:</h3><p><a target="_blank" rel="noopener" href="https://howtodoinjava.com/spring-boot2/testing/spring-integration-testing/">https://howtodoinjava.com/spring-boot2/testing/spring-integration-testing/</a></p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">JIE</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/01/15/SpringBoot%20Unit%20Test/">http://yoursite.com/2020/01/15/SpringBoot%20Unit%20Test/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">JIE's Blos</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2020/01/16/Base%20Concept%20in%20React/"><i class="fas fa-angle-left">&nbsp;</i><span>Base Concept in React</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/06/12/Automatic%20test%20using%20Selenide/"><span>Automatic test using Selenide</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2021 By JIE</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--></body></html>